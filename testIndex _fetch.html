<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>fetch from server</title>
    <script>
        // i ist immer die Nummer eines Pokemons!
        let rspCurrentPokeAsJSON = [];
        let info = '';
        let nextPoke = 1;
        let currentImageUrl = '';
        let currentNamesUrl = '';
        let rspCurrentNamesAsJSON = [];
        let currentNames = [];
        let currentGermanName = '';
        let count = 4;


        async function init() {
            clearContent();
            getAndRender();
        }


        function clearContent() {
            document.getElementById('allInfos').innerHTML = '';

        }


        async function getAndRender() {
            for (let j = 1; j <= count; j++) {
                let promises1st = [renderPokePlaces(nextPoke), getCurrentPoke(nextPoke)];
                await Promise.all(promises1st);
                let promises2nd = [takeInfo(nextPoke), renderPoke(nextPoke, info)];
                await Promise.all(promises2nd);
                await getAndRenderImage(nextPoke);
                await getAndRenderGermanName(nextPoke);
                nextPoke++;
            }
        }


        async function getAndRenderImage(i) {
            takeCurrentImageUrl();
            renderCurrentImage(i, currentImageUrl);
        }


        async function getAndRenderGermanName(i) {
            takeCurrentNamesUrl(i);
            await getCurrentNames(currentNamesUrl);
            takeCurrentGermanName()
            renderCurrentGermanName(i, currentGermanName);
        }


        async function getCurrentPoke(i) {
            let url = `https://pokeapi.co/api/v2/pokemon/${i}/`;
            let response = await fetch(url);
            let responseAsJSON = await response.json();
            rspCurrentPokeAsJSON = responseAsJSON;
            return rspCurrentPokeAsJSON;
        }


        async function getCurrentNames(url) {
            let response = await fetch(url);
            let responseAsJSON = await response.json();
            rspCurrentNamesAsJSON = responseAsJSON;
            return rspCurrentNamesAsJSON;
        }


        async function takeCurrentImageUrl() {
            currentImageUrl = rspCurrentPokeAsJSON['sprites']['other']['home']['front_default'];
            return currentImageUrl;
        }


        async function takeCurrentNamesUrl(i) {
            currentNamesUrl = rspCurrentPokeAsJSON['species']['url'];
            return currentNamesUrl;
        }


        async function takeCurrentGermanName() {
            currentNames = rspCurrentNamesAsJSON['names'];
            await searchGermanName(currentNames);
        }


        async function searchGermanName(currentGermanNames) {
            for (let j = 0; j < currentGermanNames.length; j++) {
                let language = currentGermanNames[j]['language']['name'];
                checkIfGerman(language, j);
            }
        }


        function checkIfGerman(language, j) {
            if (language == 'de') {
                currentGermanName = currentNames[j]['name'];
                return currentGermanName;
            } else {
                return;
            }
        }

        function takeInfo(i) {
            info = rspCurrentPokeAsJSON['id'];
            return info;
        }


        function renderPokePlaces(i) {
            document.getElementById('allInfos').innerHTML += generateHTMLPlaces(i);
        }


        function generateHTMLPlaces(i) {
            return `
            <div id="germanName${i}"></div>
            <div id="poke${i}"></div>
            <div id="image${i}" class="image"></div>
            `
        }


        async function renderPoke(i, info) {
            document.getElementById('poke' + i).innerHTML += generateHTMLInfo(i, info);
        }


        async function renderCurrentImage(i, url) {
            document.getElementById('image' + i).innerHTML = generateHTMLImage(url);
        }


        async function renderCurrentGermanName(i, currentGermanName) {
            document.getElementById('germanName' + i).innerHTML = generateHTMLGermanName(currentGermanName);
        }


        function generateHTMLInfo(i, info) {
            return `
            <div>i: ${i} pokeId: ${info}</div>
            `;
        }


        function generateHTMLImage(url) {
            return `
            <img src="${url}">
            `;
        }

        function generateHTMLGermanName(currentGermanName) {
            return `
            <div>${currentGermanName}</div>
            `;
        }

    </script>

    <style>
        .image {
            display: flex;
        }

        .image img {
            display: flex;
            width: 100px;

        }
    </style>

</head>

<body onload="init()">
    Testfetch
    <button onclick="getAndRender(nextPoke)">4+</button>
    <div id="allInfos"></div>
</body>

</html>